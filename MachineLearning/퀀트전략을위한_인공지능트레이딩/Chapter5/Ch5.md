# CHAPTER 5 금융에서의 머신러닝

## 5.1 왜 머신러닝을 활용해야 하는가?

### 5.1.1 머신러닝을 활용한 금융 데이터 분석

## 5.2 머신러닝 알고리즘 소개

### 5.2.1 지도학습법 - 서포트 벡터 머신

데이터가 많지 않더라도 좋은 성능을 낼 수 있다.

샘플이 많을 때는 속도와 메모리 면에서 힘들 수 있음

데이터 전처리와 매개변수 설정에 신경을 써야 함

해석 가능성이 약함

### 5.2.2 트리 기반 모델

#### 랜덤 포레스트

트리의 과적합 성향을 보완

트리가 깊어질수록 bias(편향)이 작아지지만 variance(분산)이 커짐 (자료구조 트리를 생각해봐)

분산이 큰 각 트리에 평균을 취해주면 편향을 유지하면서도 분산을 줄일 수 있음

한개의 의사 결정 트리는 노이즈에 민감하지만 이 평균이 노이즈에 대해 견고해짐(robust)

트리들의 상관관계를 줄여야 모델의 정확도가 높아진다

#### 부스팅

약한 분류기를 결합해 강한 분류기를 만드는 과정

### 5.2.3 비지도 학습법 - 차원 축소와 클러스터링

## 5.3 금융 시계열 데이터에 대한 교차 검증 방법

### 5.3.1 walk-forward 교차 검증과 blocking walk forward 교차 검증

사이킷런의 timesplit

walk-forward : 점점 늘려가는 방식

> **ex**
> 1월-3월로 학습 후 4월로 검증 -> 1월-4월로 학습 후 5월로 검증

but 여전히 데이터 누설(leakage)가 존재

-> blocking walk forward : 위 방식 + 안 겹치게

### 5.3.2 엠바고와 퍼징

훈련셋과 검증셋 사이에 마진을 두고 각 검증 단계의 훈련셋이 겹치지 않도록 설정

## 5.4 금융에서의 데이터 전처리

전처리를 통해 노이즈를 제거하자

원본 데이터를 모델이 학습하기 좋게 만들어주는 작업

벡터화(vectorization), 정규화(normalization), 결측치 다루기, 특성 추출 등

주가 모델링은 **기하 브라운 모형: Geometric Brownian Motion, GBM**을 가정,

이것은 **자기 회귀 모형: AutoRegressive Models, AR** 과 거의 동일

> **$$y_{t+1} = y_t + x_t + e_t $$**

> t+1: 내일 의 주가에 영향을 주는 요소
> y: 주가, x: 정보, e: 노이즈

금융은 데이터가 몹시 적어서 노이즈를 줄이는 것이 몹시 중요

### 5.4.1 노이즈를 줄이는 방법

불필요한 디테일을 없앰으로써 더 중요한 정보에 주목하게 하는 것

#### 이동 평균과 지수 이동 평균

주가는 상대적으로 변동성이 높아서 추세를 파악하기가 힘들다

따라서 불규칙하게 보이는 변동 부분을 제거하면 추세를 보기가 쉽다.

-> **이동 평균(moving average)**은 며칠간의 주가를 평균낸 것으로, 변동성 노이즈를 제거할 수 있음.

**지수 이동 평균(exponential moving average)**은 특정 기간의 주가 중 최근 가격에 더 큰 가중치: weight를 두어 계산.
가장 최근에 가장 큰 가중치를 주므로 단순 이동 평균에 비해 최근 추세를 더 잘 반영함

#### 웨이블릿 변환

웨이블릿 변환(wablet transform)
웨이블릿 기저 함수를 이용해 데이터를 변환

> 웨이블릿 기저 함수: 적분 시 0이 되고 진동하면서 진폭이 0으로 수렴하는 함수

웨이블릿 변환은 신호를 근삿값(approximation)과 세붓값(detail)으로 구분

근삿값은 신호의 저주파 성분(전반적 내용), 세붓값은 신호의 고주파 성분(세부 사항)을 담는다.

그리고 찾은 근삿값을 다시 반으로 나눠 근삿값과 세붓값으로 구분한다.

신호가 가진 비정상적(non-stationary) 성질을 나타내는 데 유용

#### PCA를 이용한 노이즈 제거

차원 축소에서 좋은 성능을 보여주는 머신러닝 알고리즘인 주성분 분석(Principal Component Analysis, PCA)을 사용해 노이즈를 제거하는 동시에 더 좋은 특성을 추출해 시장 예측에 사용하는 것도 자주 시도되는 방법

PCA는 여러 데이터가 모여 하나의 분포를 이룰 때 이 분포의 주성분을 분석해주는 방법

주성분은 그 방향으로 데이터들의 분산이 가장 큰 방향 벡터

주성분만으로 충분한 표현이 가능하여 복잡한 특성이나 부차적 요소를 제거할 수 있음

but 각각의 주성분을 해석하기가 어려워 모델의 해석력이 필요한 금융데이터에서는 비권장

#### 딥러닝 기반의 노이즈 제거 - 오토 인코더

딥러닝을 이용한 차원 축소(노이즈 제거)

## 5.5 머신러닝을 활용한 전략의 평가 지표

### 5.5.1 트렌드에 대한 가중치

상승률, 하락률에 따라 다른 가중치 부여

### 5.5.2 레이블 데이터 불균형 문제

마켓 레짐(market regime)에 따라 레이블 데이터 불균형이 발생할 수 있다.

### 5.5.3 다양한 지표 함께 보기

## 5.6 백테스팅

### 5.6.1 최대한 많은 경제적 시나리오를 포함하는 백테스팅 기간 설정하기

### 5.6.2 수수료와 슬리피지 고려하기

### 5.6.3 편향 고려하기

생존 편향: survivorship bias

- 중간에 상장 폐지된 종목 제외

사전 관찰 편향: look-ahead bias

- 3월 GDP지수를 4월말에 발표하는데 그것을 알고 있다는 가정하에 3월에 사용

심리적 인내 편향: psychological tolerance bias

- 결과가 좋아도 하락 구간을 최대한 줄이자

### 5.6.4 특정 주가가 아닌 전체 자산 종류나 투자 영역에 대한 모델 개발하기

특정 종목보다 자산 부류를 예측하는 것이 과적합을 조금이나마 줄이는 방법 

### 5.6.5 여러 지표 활용하기 

### 5.6.6 시계열 분석에 맞는 교차 검증 방법 활용하기 

## 5.7 머신러닝 알고리즘 구현을 위한 사이킷런 
